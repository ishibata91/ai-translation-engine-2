# Frontend Job Manager 仕様

## Purpose
TBD: フロントエンドからの長時間のタスク（辞書構築、翻訳プロジェクトなど）の管理、状態の永続化、再開、フェーズ完了通知などの処理に関する仕様を定義する。

## Requirements

### Requirement: タスクの永続化と再開ロジック
FrontendTaskManager は、フロントエンド向けタスク（辞書構築、ペルソナ抽出等）の状態を SQLite に永続化しなければならない。
タスクモデルには、再開に必要な十分なコンテキスト（`target_file`, `options` などのJSONメタデータ）と `Phase` (現在のステップ) を含めること。

#### Scenario: 予期せぬ終了からの復帰
- **WHEN** 翻訳タスク実行中にアプリが強制終了し、再起動された
- **THEN** アプリ初期化時に TaskManager が DB の `Running` または `Paused` 状態のタスクを検出し、
- **AND** フロントエンドでの Resume 呼び出し時に保存されたメタデータとフェーズを元に処理を再開する。

### Requirement: フェーズ毎の完了通知とデータ反映（Phase Completion）
タスクが複数フェーズに分割されている場合（例：「ペルソナ抽出処理」から「要約処理」への移行など）、1つのフェーズが完了した時点で、そのフェーズで生成された一括データをメインDBへ保存し、フロントエンドへ個別のイベント `task:phase_completed` をEmitしなければならない。
※N+1問題を防ぐため、1NPCごと・1単語ごとの単体データEmitは行わず、ループ処理中は進捗(Progress)のみを更新し、フェーズの区切りでデータを反映させること。

#### Scenario: ペルソナ抽出フェーズの完了とフロントエンド反映
- **WHEN** ユーザーが「翻訳プロジェクト開始」タスクを実行中で、「ペルソナ抽出フェーズ」のループ処理がすべて終わった
- **THEN** TaskManager は生成された全NPCデータをDBにコミットし、`task:phase_completed`（種別: 'persona_extracted'）イベントをEmitする。
- **AND** フロントエンドの状態ストアはそれを受信して、ペルソナ一覧表示の再取得や画面の更新を一括で実施する。

### Requirement: ダッシュボードからのフェーズ復帰と画面遷移
タスクの現在の `Phase` が更新された場合、フロントエンドのダッシュボードはそのフェーズ情報を認識し、ユーザーがクリックした際に適切な画面（と必要なパラメータ）へルーティングできる仕組みを提供しなければならない。

#### Scenario: 複数ステップの翻訳プロジェクトの途中遷移
- **WHEN** ダッシュボードのタスク一覧で、ステータスが「ペルソナ抽出待機中(Phase: PersonaExtraction)」となっているタスクをクリックした
- **THEN** アプリケーションは翻訳プロジェクト詳細画面へ遷移し、自動的に「ペルソナパネル」のタブを開いて状態を復元する。

### Requirement: Wailsバインディングの拡張
TaskManager は従来の `GetActiveTasks`, `CancelTask` に加え、中断されたタスクを再開するための `ResumeTask` 等のバインディングを提供しなければならない。
