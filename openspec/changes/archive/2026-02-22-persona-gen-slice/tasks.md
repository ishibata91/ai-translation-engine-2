## 1. コア構造と DTO

- [x] 1.1 `pkg/persona_gen` パッケージを作成し、`contract.go` を定義する。
- [x] 1.2 グローバルな `pkg/domain` モデルに依存しない `PersonaGenInput` DTO を定義する。
- [x] 1.3 スライス内にコアインターフェース（`ImportanceScorer`, `TokenEstimator`, `PersonaStore`）を定義する。
- [x] 1.4 Wire 依存性注入のための基本的な DI プロバイダ（`provider.go`）を設定する。

## 2. 重要度スコアリングとトークン推定

- [x] 2.1 固有名詞のカウントと感情指標（!, ?, すべて大文字, 強い単語）を使用して会話をスコアリングする `ImportanceScorer` を実装する。
- [x] 2.2 予想されるトークン数（テキスト長 / 4 + 固定バッファ）を計算し、コンテキストのオーバーフローを防ぐ `TokenEstimator` を実装する。
- [x] 2.3 トークン制限を超えた場合に、スコアの低い会話を除外する機能を追加する。

## 3. データベースとペルソナストア

- [x] 3.1 初期化された SQLite 接続をカプセル化する `PersonaStore` を実装する。
- [x] 3.2 ストア内に `npc_personas` テーブルを作成するマイグレーションロジックを追加する。
- [x] 3.3 生成されたペルソナレコードを保存または更新する `UpsertPersona` メソッドを実装する。

## 4. LLM 生成とコアラジック

- [x] 4.1 メインの生成ワークフローを実装する：会話を `SpeakerID` でグループ化する。
- [x] 4.2 各 NPC について、トークン推定機と重要度スコアラーを通して会話を処理する。
- [x] 4.3 `LLMManager`（ConfigStore の設定を使用）を使用して、事前定義されたシステムプロンプトでペルソナ生成をリクエストする。
- [x] 4.4 `trace_id` を渡す `slog.DebugContext` ベースの構造化された Entry/Exit ログを追加する。

## 5. テスト

- [x] 5.1 インメモリの SQLite データベースを利用して、スライスレベルのパラメタライズドテスト（`generator_test.go`）を作成する。
- [x] 5.2 LLM のレスポンスをモック化し、実際の API 呼び出しを行わずにパイプライン全体を検証する。
- [x] 5.3 トークン制限による除外動作とデータベースの Upsert の振る舞いを検証する。
