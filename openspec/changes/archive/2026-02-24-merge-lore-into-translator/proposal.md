# 提案: 本文翻訳 (Pass 2 Translator Slice) の実装完了

## 現状
- `Pass 2 Translator Slice` は既に基本的なディレクトリ構造と一部のインターフェース、データ構造（`dto.go`）、プロンプト生成（`propose.go`）の骨格が作成されています。
- しかし、`specs/translator/spec.md` に記載されている以下の重要な機能が未実装、または統合が不完全です。
    - **Context Engine の統合**: 会話ツリー解析、話者プロファイリング、辞書検索、要約参照をプロンプト生成に統合する。
    - **データベース永続化**: 翻訳結果を JSON ファイルではなく、SQLite データベース (`{PluginName}_translations.db`) に保存します。
    - **Export Slice との連携**: 翻訳済みのデータは `Export Slice` がこの DB から読み込み、最終的な xTranslator XML 形式で出力します。

    - **HTMLタグ処理**: タグの抽象化（プレースホルダー化）と復元、ハルシネーションチェック。
    - **書籍のチャンク分割**: 長文の `BOOK DESC` を分割して個別のジョブとして生成。
    - **差分更新 (Resume)**: 既存のJSONファイルを読み込み、処理済みレコードをスキップする。

## 提案
`specs/translator/spec.md` に定義された仕様に完全に基づき、残りのコンポーネントを実装し、既存の骨格を完成させます。

### 主な変更内容
1.  **Phase 2: Save の実装**: LLMレスポンスを受け取り、JSONファイルに保存する一連の流れを完成させます。
2.  **Tag Processor の実装**: ゲーム特有のタグを安全に保護・復元するロジックを追加します。
3.  **Context Engine の具体化**: `pkg/translator/context_engine.go` に、会話コンテキストや辞書情報を取得するロジックを実装し、プロンプト構築に統合します。
4.  **Resume 機能**: 出力先ディレクトリを確認し、重複翻訳を避けるロジックを実装します。

## 期待される効果
- LLMバッチAPIなどの長時間実行に対応可能な、堅牢な2フェーズ翻訳パイプラインが完成する。
- 高度な文脈理解（Lore統合）により、翻訳品質が向上する。
- 処理の中断と再開が可能になり、大規模な翻訳作業の信頼性が向上する。
