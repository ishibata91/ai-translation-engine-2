## MODIFIED Requirements

### 1. 2フェーズモデル（提案/保存モデル） (Propose/Save Model)

**Reason**: Loreスライスを統合し、ゲームデータから直接翻訳ジョブ（文脈を含むプロンプト）を構築可能にするため。

#### Scenario: 翻訳ジョブの提案 (Phase 1: Propose)
- **WHEN** プロセスマネージャーから翻訳対象のゲームデータ群を受け取った
- **THEN** 内部の Context Engine を呼び出し、会話ツリー解析、話者プロファイリング、参照用語検索を行い文脈（Context）を構築する
- **AND** 既存ファイルから成功済みレコードを検索（Resume）し、未処理分を特定する
- **AND** 未処理分に対し、タグ保護とプロンプト構築（構築された文脈をテンプレートに埋め込む）を行い、`[]llm.Request` を返す
- **AND** 強制翻訳可能なレコードや `cached` 分は、即時結果として分離して返す
- **AND** `specs/architecture.md` に従い、関数の開始・終了ログを TraceID 付きで出力する

### 2. 独立性: 第2パス翻訳向けデータの受け取りと独自DTO定義

**Reason**: Lore統合に伴い、入力データが「構築済みの TranslationRequest」から「生のゲームデータを含む入力DTO」に変更されるため。

#### Scenario: 独自定義DTOによる初期化とプロンプト構築
- **WHEN** オーケストレーター層から本スライス専用の入力DTO（ゲームデータを含む）が提供された場合
- **THEN** 外部パッケージのDTOに一切依存することなく、提供された内部データ構造のみを用いて、文脈解析からプロンプト構築までを完結できること

## ADDED Requirements

### Requirement: 統合された文脈構築ロジック (Context Engine)
本スライスは、旧Loreスライスが担当していた全ての文脈構築ロジック（会話ツリー解析、話者プロファイリング、辞書検索、要約参照）を内部コンポーネントとして保持しなければならない。

#### Scenario: 文脈を統合したプロンプト構築
- **WHEN** 翻訳リクエストの構築処理（Phase 1）が実行された場合
- **THEN** レコードの種類に応じて、会話ツリーのトラバース、話者プロファイル取得、キーワードベースの辞書検索を内部で実行する
- **AND** 取得された文脈情報を、プロンプトテンプレートの所定のプレースホルダーに埋め込む
- **AND** `TranslationRequest` という中間データ構造を外部（スライス境界）に露出させることなく処理を完結させる
