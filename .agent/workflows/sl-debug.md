---
description: structured-log-debug-workflow
---

# 構造化ログデバッグ (Structure Log Debugging)

このワークフローは、`specs/log-guide.md` の「AI解析に最適化されたログ設計」ルールに基づき、AIが構造化されたJSONログとメタデータを元にシステムの動作をトレースし、根本原因を特定するための手順です。

## 手順

### 1. アプリケーションの実行とログ監視の準備
AIは、アプリケーションから出力される構造化ログ（JSON）を読み取れる状態にします。具体的には、新しくプロセスを起動しターミナルの出力を監視するか、または `logs/` ディレクトリ等に生成されるログファイルを後から読み取る準備をします。
準備が完了したら、ユーザーに対して「ログを監視する準備ができました。該当の操作を行ってください」と案内します。

### 2. ユーザーによる事象の再現
ユーザーは手動でアプリケーションのUI等を操作し、目的の動作やエラーを発生させます。
操作終了後、ユーザーはチャットでAIに「操作が終わりました」「エラーが出ました」等の合図を伝えます。

### 3. メタデータ群の解析と原因究明
AIは直近のログを読み取り、`specs/log-guide.md` の「第4部：推論フロー」に従って以下の解析を行います。

1. **エラー・遅延の起点探索**: `level="ERROR"` や高 `duration_ms` のログ、または当該事象に起因する代表的な `trace_id` を見つけます。
2. **トレースの全容把握**: 発見した `trace_id` を持つ全てのログデータを時系列（SpanIDや出力順）に展開し、処理のパイプライン・フローを再構築します。
3. **コンテキストの解読**:
   - `action` または `event_name` (何をしたか)
   - 変数値、`state_before` / `state_after` (どのように状態が変化したか)
   - 条件分岐の理由 (なぜその処理ルートに入ったか)
   - `error_code` / `stack_trace` / `exception_class` (なぜ失敗したか)
4. **根本原因特定と修正提案**: AIはログから読み取れる「事実」に基づき、「なぜ問題が起きたのか」を論理的に説明し、修正すべきコードの提案や仕様書（スペック）への修正案を提示します。